(()=>{"use strict";var t={931:(t,e,i)=>{i.d(e,{l:()=>a});i(10),i(336),i(925),i(421),i(298);const a=document.getElementById("app")},421:(t,e,i)=>{t.exports=i.p+"assets/d2d2f215d1a01dadb341.ico"},336:(t,e,i)=>{t.exports=i.p+"../docs/basic//index.html"},10:(t,e,i)=>{t.exports=i.p+"../docs//index.html"},298:(t,e,i)=>{t.exports=i.p+"assets/2f0a58e7238c9669943c.ico"},925:(t,e,i)=>{t.exports=i.p+"../docs/pro//index.html"},731:(t,e,i)=>{t.exports=i.p+"assets/d2d2f215d1a01dadb341.ico"},84:(t,e,i)=>{t.exports=i.p+"assets/2f0a58e7238c9669943c.ico"}},e={};function i(a){var s=e[a];if(void 0!==s)return s.exports;var n=e[a]={exports:{}};return t[a](n,n.exports,i),n.exports}i.d=(t,e)=>{for(var a in e)i.o(e,a)&&!i.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var a=e.getElementsByTagName("script");a.length&&(t=a[a.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t+"../"})(),(()=>{var t=i(931),e=i(731),a=i(84);class s{static head(t,e){return`\n                <svg xmlns='http://www.w3.org/2000/svg'\n                    width='${t}'\n                    height='${t}'\n                    fill = '${e}'\n                    viewBox = '0 0 16 16' >\n                `}static show(t,e,i="currentColor"){return s.head(e,i)+t+s.tail}}s.tail="</svg>";class n{}n.icon="<path d='M1 2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V2zM1 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V7zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V7zM1 12a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1v-2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-2z'/>";class r{}function l(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))?"mobile":"desktop"}r.icon="<path fill-rule='evenodd' d='M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z'/>";class o{constructor(t,e){this.currentApp=t,this.toggleCloseArea=e,this._button=document.createElement("div"),this.appList=document.createElement("div"),this.isAppListExpanded=!1,this.createButton(),this.createAppList()}get button(){return this._button}createButton(){this._button.classList.add("header-btn"),this._button.id="main-btn",this._button.innerHTML=s.show(n.icon,20),"desktop"==l()?(this._button.addEventListener("click",(()=>{this.toggleAppList()})),this.toggleCloseArea.addEventListener("click",(t=>{t.path.includes(this._button)||this.foldUp()}))):this._button.addEventListener("click",(()=>{this.expand()}))}createAppList(){if(this.appList.classList.add(l()),this.appList.id="app-list",this._button.appendChild(this.appList),"mobile"===l()){let t=document.createElement("div");t.id="app-list-leave-button",t.innerHTML=s.show(r.icon,28),t.addEventListener("click",(t=>{this.foldUp(),t.stopPropagation()})),this.appList.appendChild(t)}let t=document.createElement("a");t.classList.add("app-option"),this.appList.appendChild(t);let i=document.createElement("img");i.src=e,t.appendChild(i);let n=document.createElement("div");n.innerText="Basic",t.appendChild(n);let o=document.createElement("a");o.classList.add("app-option"),this.appList.appendChild(o);let d=document.createElement("img");d.src=a,o.appendChild(d);let h=document.createElement("div");h.innerText="Pro",o.appendChild(h),t.href="../basic/",o.href="../pro/","basic"===this.currentApp?(t.href="#",t.classList.add("active")):"pro"===this.currentApp&&(o.href="#",o.classList.add("active"))}toggleAppList(){this.isAppListExpanded?this.foldUp():this.expand()}expand(){this.appList.classList.add("active"),this.isAppListExpanded=!0}foldUp(){"mobile"===l()?setTimeout((()=>{this.appList.classList.add("leaving"),setTimeout((()=>{this.appList.classList.remove("leaving"),this.appList.classList.remove("active"),this.isAppListExpanded=!1}),300)}),0):(this.appList.classList.remove("active"),this.isAppListExpanded=!1)}}class d{static suffleArray(t){for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1)),a=t[e];t[e]=t[i],t[i]=a}return t}static avg(t){return 0===t.length?0:t.reduce(((t,e)=>t+e),0)/t.length}static mySigmoid(t){return 1/(1+150*Math.pow(Math.E,-10*t))}static normalSample(t,e){let i=0,a=0;for(;0===i;)i=Math.random();for(;0===a;)a=Math.random();return e*Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*a)+t}static oneTailNormalSample(t,e,i){let a=0,s=0;for(;0===a;)a=Math.random();for(;0===s;)s=Math.random();return"left"===i?-1*Math.abs(e*Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s))+t:Math.abs(e*Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*s))+t}}class h{constructor(){this.name="ValueFollower"}followStrategy(t,e,i,a,s,n){let r=a,l=r;return{today:t,buyP:r,buyQ:Math.max(0,Math.round(e/r*(1-s/r))),sellP:l,sellQ:Math.max(0,Math.round(i.length*(1-l/s)))}}}class c{constructor(){this.name="PriceChaser"}followStrategy(t,e,i,a,s,n){void 0!==this.pYesterday&&void 0!==this.initialMktVal||(this.pYesterday=s*Math.max(0,d.normalSample(1,.1/3)),this.initialMktVal=a);let r=Math.abs((s-this.pYesterday)/this.pYesterday),l=a/this.initialMktVal,o=s*Math.max(0,d.normalSample(l,.1*(l+r)/3));return this.pYesterday=s,{today:t,buyP:o,buyQ:o>s?Math.max(0,Math.round(e/o*(o/s)*Math.max(.01,r))):0,sellP:o,sellQ:o<s?Math.max(0,Math.round(i.length*(s/o)*Math.max(.01,r))):0}}}class m{constructor(){this.name="BHmixGrid",this.latestMaxP=-1/0,this.latestMinP=1/0}followStrategy(t,e,i,a,s,n){let r=n.r;if(0===i.length||1===t)this.latestMaxP=s,this.latestMinP=this.latestMaxP;else for(let t of i)t.buyInCost>this.latestMaxP&&(this.latestMaxP=t.buyInCost),t.buyInCost<this.latestMinP&&(this.latestMinP=t.buyInCost);let l=this.latestMaxP,o=this.latestMinP,d=0,h=0;return 0===i.length||s<this.latestMaxP&&s<this.latestMinP?d=this.calcQToday(e,s,r):s>this.latestMaxP&&(h=i.length),{today:t,buyP:o,buyQ:d,sellP:l,sellQ:h}}calcQToday(t,e,i){let a=t/e;return Math.floor(i*a)}}class u{constructor(){this.name="CRG",this.latestTradePrice=0}followStrategy(t,e,i,a,s,n){let r=n.sensitivity,l=n["stock-ratio"],o=s*Math.max(.9,Math.min(1.1,d.normalSample(1,.033))),h=o,c=0,m=0;if(i.length>=2?this.latestTradePrice=i.reduce(((t,e)=>t.buyInDay>e.buyInDay?t:e)).buyInCost:1===i.length&&(this.latestTradePrice=i[0].buyInCost),1===t||0===i.length)c=Math.floor(e*l/o);else{let t=(o-this.latestTradePrice)/this.latestTradePrice,a=(o-this.latestTradePrice)/o;if(t>=r){if(i.length>0){for(;(i.length-m)*h>e+m*h;)m++;m=Math.min(i.length,m)}}else if(a<=-1*r)for(;(i.length+c)*o<e-c*o;)c++}return{today:t,buyP:o,buyQ:c,sellP:h,sellQ:m}}}class p{constructor(){this.name="Chicken",this.latestMaxP=-1/0,this.latestMinP=1/0}followStrategy(t,e,i,a,s,n){let r=n.r,l=n["runaway-rate"],o=s*Math.max(.9,Math.min(1.1,d.normalSample(1,.033))),h=o,c=0,m=0;if(0===i.length)h>s&&(this.latestMinP=h,this.latestMaxP=h,c=this.calcQToday(r,e,h));else{let t=Math.max(...i.map((t=>t.buyInCost)));h>Math.max(t,this.latestMaxP)?(this.latestMaxP=h,c=this.calcQToday(r,e,h)):h<Math.max(t,this.latestMaxP)*l&&(m=i.length)}return{today:t,buyP:h,buyQ:c,sellP:o,sellQ:m}}calcQToday(t,e,i){const a=e/i;if(a<1)return 0;let s=t,n=Math.floor(a*s);return n>1?n:1}}class g{constructor(t,e,i,a){this._type=t,this._today=e,this._price=i,this._quantity=a}get type(){return this._type}get today(){return this._today}get price(){return this._price}get quantity(){return this._quantity}set quantity(t){this._quantity=t}}class y{constructor(t,e,i,a,s=Math.random(),n=!0){this._strategyColor={ValueFollower:"#D00",PriceChaser:"#000",BHmixGrid:"#0A0",GridConstRatio:"#00A",Chicken:"#A0A"},this._allStrategies={ValueFollower:h,PriceChaser:c,BHmixGrid:m,GridConstRatio:u,Chicken:p},this.divControlled=t,this._strategySetting=e,this._aggressiveness=s,this._aggressivenessChangable=n,this._initialCash=i,this._cashOwning=i,this._stockHolding=a,this._initialHolding=a.length,this._initialTotalAsset=this.calcTotalAsset(),this._tradeAmount=0,this._strategy=this.chooseStrayegy(e.name),this._today=void 0,this._valueAssessed=void 0,this._mktPriceAcquired=void 0,this._maxPayable=void 0,this._minSellable=void 0,this._orderSetToday={buyOrder:new g("buy",NaN,NaN,NaN),sellOrder:new g("sell",NaN,NaN,NaN)}}get orderSetToday(){return this._orderSetToday}get initialCash(){return this._initialCash}get cashOwning(){return this._cashOwning}get stockHolding(){return this._stockHolding}get initialHolding(){return this._initialHolding}get initialTotalAsset(){return this._initialTotalAsset}get tradeAmount(){return this._tradeAmount}calcReturn(t){return Math.round(1e3*(this.calcTotalAsset(t)/this._initialTotalAsset-1))/1e3}calcTotalAsset(t){return this._cashOwning+this.calcStockMktVal(t)}calcStockMktVal(t){let e=0;for(let i of this._stockHolding)e+=void 0!==t?t:i.buyInCost;return e}chooseStrayegy(t){this.divControlled.style.backgroundColor=this._strategyColor[t];try{return new this._allStrategies[t]}catch(t){throw"Strategy undefined."}}updateMktInfo(t,e,i,a){this._today=t,this._valueAssessed=e,this._mktPriceAcquired=i,this._cashOwning+=this._initialCash*a}makeOrder(){if(void 0!==this._today&&void 0!==this._mktPriceAcquired&&void 0!==this._valueAssessed){let t=this._strategy.followStrategy(this._today,this._cashOwning,this._stockHolding,this._valueAssessed,this._mktPriceAcquired,this._strategySetting.params),e=t.buyQ,i=t.sellQ;this._maxPayable=t.buyP,this._minSellable=t.sellP;let a=this.bid(),s=this.ask();if(this.decreaseAggressiveness(),void 0!==this._today)return this._orderSetToday={buyOrder:new g("buy",this._today,a,e),sellOrder:new g("sell",this._today,s,i)},this._orderSetToday;throw"_today is undefined, try updateMktInfo() first."}throw"market info not sufficient when making order"}bid(){if(void 0!==this._maxPayable)return this._maxPayable*(1-this._aggressiveness);throw"The _maxPayable is undefined."}ask(){if(void 0!==this._minSellable)return this._minSellable*(1/(1-this._aggressiveness+Number.EPSILON));throw"The _minSellable is undefined."}buyIn(t,e,i){this.increaseAggressiveness();for(let a of t)a.buyInCost=e,a.buyInDay=i;this._stockHolding=this._stockHolding.concat(t),this._cashOwning-=t.length*e,this._tradeAmount+=t.length}sellOut(t,e){this.increaseAggressiveness(),this._stockHolding.sort(((t,e)=>t.buyInDay-e.buyInDay));let i=this._stockHolding.splice(0,t);return this._cashOwning+=t*e,this._tradeAmount+=t,i}decreaseAggressiveness(){this._aggressivenessChangable&&(this._aggressiveness+=Math.max(-1*this._aggressiveness,d.oneTailNormalSample(0,this._aggressiveness/3,"left")))}increaseAggressiveness(){this._aggressivenessChangable&&(this._aggressiveness+=Math.min(1-this._aggressiveness,d.oneTailNormalSample(0,(1-this._aggressiveness)/3,"right")))}}class v{constructor(t,e){this._numOfPairOut=0,this._equilibrium=t,this._priceChangeSpeed=e}get equilibrium(){return this._equilibrium}genAssessedVal(t){return this._numOfPairOut>0&&this._numOfPairOut%this._priceChangeSpeed==0?(this._equilibrium*=Math.max(0,d.normalSample(1,.001)),this._numOfPairOut++):t&&this._numOfPairOut++,this._equilibrium*Math.max(0,d.normalSample(1,.1/3))}}class f{constructor(t,e){this._buyInCost=t,this._buyInDay=e}get buyInCost(){return this._buyInCost}set buyInCost(t){this._buyInCost=t}get buyInDay(){return this._buyInDay}set buyInDay(t){this._buyInDay=t}}class b{constructor(){this._option={},this._chartType=""}drawChart(t){let e=google.visualization.arrayToDataTable(t);this._chart.draw(e,this._option)}}class S extends b{constructor(t){super(),this._option={title:"My Asset",titleTextStyle:{fontSize:16,bold:!1,color:"#777"},curveType:"none",width:.98*t.offsetWidth,height:.98*t.offsetHeight,chartArea:{left:"15%",top:"10%",width:"65%",height:"80%"}},this._chartType="LineChart",google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback((()=>{this._chart=new google.visualization[this._chartType](t)}))}}class C extends b{constructor(t){super(),this._option={curveType:"none",width:t.offsetWidth,height:t.offsetHeight,vAxis:{title:"Q"},hAxis:{title:"P"},chartArea:{left:"10%",top:"5%",width:"75%",height:"90%"}},this._chartType="LineChart",google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback((()=>{this._chart=new google.visualization[this._chartType](t)}))}}class E extends b{constructor(t){super(),this._option={width:t.offsetWidth,height:t.offsetHeight,legend:{position:"none"},series:{0:{color:"#888"}},chartArea:{left:"10%",top:"5%",width:"75%",height:"90%"}},this._chartType="ColumnChart",google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback((()=>{this._chart=new google.visualization[this._chartType](t)}))}}class T extends b{constructor(t){super(),this._option={curveType:"none",width:t.offsetWidth,height:t.offsetHeight,chartArea:{left:"10%",top:"5%",width:"75%",height:"90%"}},this._chartType="LineChart",google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback((()=>{this._chart=new google.visualization[this._chartType](t)}))}}(new class{constructor(){this.STRATEGIES={"value-follower":{displayedName:"ValueFollower",otherDetails:[]},"price-chaser":{displayedName:"PriceChaser",otherDetails:[]},"bh-mix-grid":{displayedName:"BHmixGrid",otherDetails:["r"]},"grid-const-ratio":{displayedName:"GridConstRatio",otherDetails:["sensitivity","stock-ratio"]},chicken:{displayedName:"Chicken",otherDetails:["r","runaway-rate"]}},this.startBtn=document.getElementById("start-btn"),this.resetBtn=document.getElementById("reset-btn"),this.settingBtn=document.getElementById("setting-btn"),this.settingBg=document.getElementById("setting-background"),this.settingCntnr=document.getElementById("setting-container"),this.allSettingHeaderTabs=document.getElementsByClassName("setting-header-tab"),this.allParamFields=document.getElementsByClassName("parameter-field"),this.initTotalCashInput=document.getElementById("init-total-cash"),this.totalStockInput=document.getElementById("total-stock"),this.initialEqInput=document.getElementById("initial-eq"),this.annualEconGrowthRateInput=document.getElementById("annual-econ-growth-rate"),this.dayToSimulateInput=document.getElementById("day-to-simulate"),this.pauseTimeInput=document.getElementById("pause-time"),this.composeParamField=document.getElementById("compose-parameter-field"),this.myselfParamField=document.getElementById("myself-parameter-field"),this.detailCntnr=document.getElementById("detail-container"),this.settingFooter=document.getElementById("setting-footer"),this.myAssetChartCntnr=document.getElementById("my-asset-chart-container"),this.myAssetChartHeader=document.getElementById("my-asset-chart-header"),this.myAssetChart=document.getElementById("my-asset-chart"),this.animationField=document.getElementById("animation-field"),this.marketEqChart=document.getElementById("market-eq-chart"),this.dealAmountChart=document.getElementById("deal-amount-chart"),this.curveChart=document.getElementById("curve-chart")}createNodeDiv(t){let e=document.createElement("div");return e.className="node",e.style.width=`${this.nodeDivSize}px`,e.style.height=`${this.nodeDivSize}px`,e.style.transitionDuration=t/2+"ms",this.animationField.appendChild(e),e}applyAllSetting(){if(void 0!==this.marketEqData&&void 0!==this.dealAmountData&&void 0!==this.individualList&&void 0!==this.initTotalCash&&void 0!==this.totalStock&&void 0!==this.initialEq&&void 0!==this.pauseTime){this.numOfIndividual=1;for(let t in this.indiviComposition)this.numOfIndividual+=this.indiviComposition[t].number;this.pm=new v(this.initialEq,this.numOfIndividual),this.nodeDivSize=0,this.nodeDivSize=Math.min(this.animationField.offsetHeight,this.animationField.offsetWidth)/Math.ceil(Math.pow(this.numOfIndividual,.35)),this.animationField.style.gridTemplateColumns=`repeat(auto-fit, minmax(${this.nodeDivSize+10}px, 1fr))`,this.animationField.style.gridTemplateRows=`repeat(auto-fit, ${this.nodeDivSize+10}px)`;let t=this.initTotalCash,e=this.totalStock,i=this.createNodeDiv(this.pauseTime);i.id="me",i.addEventListener("click",(()=>{this.myAssetChartCntnr.classList.add("active")}));let a=this.myselfSetting.initialCash,s=this.myselfSetting.initialStock;t-=a,e-=s;let n=[];for(let t=0;t<s;t++)n.push(new f(this.pm.equilibrium,0));this.me=new y(i,this.myselfSetting.strategySetting,a,n,0,!1),this.individualList.push(this.me);let r=1;for(let i in this.indiviComposition)for(let a=0;a<this.indiviComposition[i].number;a++){let a,s,n=this.createNodeDiv(this.pauseTime);r===this.numOfIndividual-1?(a=t,s=e):(a=Math.min(t,Math.floor(this.initTotalCash/this.numOfIndividual*Math.max(0,d.normalSample(1,.1)))),s=Math.min(e,Math.floor(this.totalStock/this.numOfIndividual*Math.max(0,d.normalSample(1,2))))),t-=a,e-=s;let l=[];for(let t=0;t<s;t++)l.push(new f(this.pm.equilibrium,0));this.individualList.push(new y(n,this.indiviComposition[i].strategySetting,a,l)),r++}this.marketEqData.push([1,this.pm.equilibrium,this.initialEq]),this.dealAmountData.push([1,0])}}simulateOneDay(){if(void 0!==this.marketEqData&&void 0!==this.dealAmountData&&void 0!==this.myAssetData&&void 0!==this.individualList&&void 0!==this.dayToSimulate&&void 0!==this.curveChartDrawer&&void 0!==this.marketEqChartDrawer&&void 0!==this.dealAmountChartDrawer&&void 0!==this.myAssetChartDrawer){let t=this.marketEqData.length-1;this.everyoneUpdInfoAndOrder(t),this.individualList=d.suffleArray(this.individualList);let e=[],i=[];for(let t of this.individualList){let a=t.makeOrder();a.buyOrder.quantity>0&&e.push(t),a.sellOrder.quantity>0&&i.push(t)}e.sort(((t,e)=>{if(void 0!==e.orderSetToday&&void 0!==t.orderSetToday)return e.orderSetToday.buyOrder.price-t.orderSetToday.buyOrder.price;throw"orderSetToday is undefined when queuing buySideQueue."})),i.sort(((t,e)=>{if(void 0!==e.orderSetToday&&void 0!==t.orderSetToday)return t.orderSetToday.sellOrder.price-e.orderSetToday.sellOrder.price;throw"orderSetToday is undefined when queuing sellSideQueue."}));let a=this.prepareCurveData(e,i);if(this.curveChartDrawer.drawChart(a),this.matching(t,e,i),!(t<=this.dayToSimulate))return void this.enableChangeSetting();this.marketEqChartDrawer.drawChart(this.marketEqData),this.dealAmountChartDrawer.drawChart(this.dealAmountData),this.myAssetChartDrawer.drawChart(this.myAssetData),this.showIndividualInfo(),setTimeout((()=>{this.simulateOneDay()}),this.pauseTime)}}everyoneUpdInfoAndOrder(t){if(void 0!==this.marketEqData&&void 0!==this.individualList&&void 0!==this.pm&&void 0!==this.annualEconGrowthRate)for(let e of this.individualList){let i=this.pm.genAssessedVal(!0),a=parseFloat(`${this.marketEqData.slice(-1)[0].slice(-1)[0]}`);e.updateMktInfo(t,i,a,this.annualEconGrowthRate/250)}}matching(t,e,i){let a,s,n=0,r=0,l=0,o=[];for(s=e.length>n&&i.length>r&&e[n].orderSetToday.buyOrder.price>=i[r].orderSetToday.sellOrder.price;s;){let t=Math.min(e[n].orderSetToday.buyOrder.quantity,i[r].orderSetToday.sellOrder.quantity);if(e[n].orderSetToday.buyOrder.quantity-=t,i[r].orderSetToday.sellOrder.quantity-=t,e[n]!==i[r])if(l+=t,o.push({buySide:e[n],sellSide:i[r],q:t}),0===e[n].orderSetToday.buyOrder.quantity&&0===i[r].orderSetToday.sellOrder.quantity)a=d.avg([e[n].orderSetToday.buyOrder.price,i[r].orderSetToday.sellOrder.price]);else if(0===e[n].orderSetToday.buyOrder.quantity)a=i[r].orderSetToday.sellOrder.price;else{if(0!==i[r].orderSetToday.sellOrder.quantity)throw"wierd!";a=e[n].orderSetToday.buyOrder.price}0===e[n].orderSetToday.buyOrder.quantity&&n++,0===i[r].orderSetToday.sellOrder.quantity&&r++,s=e.length>n&&i.length>r&&e[n].orderSetToday.buyOrder.price>=i[r].orderSetToday.sellOrder.price}if(void 0!==this.marketEqData&&void 0!==this.dealAmountData&&void 0!==this.myAssetData&&void 0!==this.pm&&void 0!==this.me){if(void 0===a)a=parseFloat(`${this.marketEqData[this.marketEqData.length-1][2]}`);else for(let e of o)this.deal(e.buySide,e.sellSide,e.q,a,t);this.marketEqData.push([this.marketEqData.length,this.pm.equilibrium,a]),this.dealAmountData.push([this.marketEqData.length,l]),this.myAssetData.push([this.marketEqData.length,this.me.calcTotalAsset(a),this.me.calcStockMktVal(a),this.me.cashOwning])}e.length=0,i.length=0,o.length=0}deal(t,e,i,a,s){let n=e.sellOut(i,a);t.buyIn(n,a,s)}showIndividualInfo(){if(void 0!==this.marketEqData&&void 0!==this.individualList)for(let t of this.individualList){let e=document.createElement("div"),i=document.createElement("div");i.innerHTML=`${t.initialHolding}`,e.appendChild(i);let a=document.createElement("div");a.innerHTML=`$${t.initialTotalAsset}`,e.appendChild(a);let s=document.createElement("div");s.innerHTML=`${t.tradeAmount}`,e.appendChild(s);let n=document.createElement("div");n.innerHTML=`${t.stockHolding.length}`,e.appendChild(n);let r=document.createElement("div"),l=parseFloat(`${this.marketEqData[this.marketEqData.length-1][2]}`);r.innerHTML=Math.round(1e4*t.calcReturn(l))/100+"%",e.appendChild(r),t.divControlled.innerHTML="",t.divControlled.appendChild(e)}}prepareCurveData(t,e){if(void 0!==this.initialEq){let i=0,a=2*this.initialEq-i,s=[];for(let t=0;t<50;t++)s.push(i+a/50*t);let n=[["price","D","S"]];for(let i of s){let a=0,s=0;for(let e of t)void 0!==e.orderSetToday&&e.orderSetToday.buyOrder.price>=i&&(a+=e.orderSetToday.buyOrder.quantity);for(let t of e)void 0!==t.orderSetToday&&t.orderSetToday.sellOrder.price<=i&&(s+=t.orderSetToday.sellOrder.quantity);n.push([i,a,s])}return n}throw"initialEq undefined while preparing curve data"}buildCompositionSettingView(){for(let t in this.STRATEGIES){let e=document.createElement("div");e.classList.add("parameter-row");let i=document.createElement("div");i.classList.add("parameter-label"),i.classList.add("strategy-name"),i.innerText=this.STRATEGIES[t].displayedName;let a=document.createElement("input");a.classList.add("parameter-input"),a.classList.add("strategy-number-input"),a.type="number",a.id=`${t}-number`;let s=document.createElement("label");s.id=`${t}-detail`,s.classList.add("strategy-detail-btn"),s.htmlFor=`${t}-detail-field`,s.innerText="detail",s.addEventListener("click",(t=>{var e;this.detailCntnr.classList.add("active");for(let t of this.detailCntnr.children)t.classList.remove("active");t.currentTarget instanceof HTMLLabelElement&&(null===(e=document.getElementById(`${t.currentTarget.htmlFor}`))||void 0===e||e.classList.add("active"));let i=document.getElementsByClassName("strategy-detail-btn");for(let e of i)e===t.currentTarget?e.classList.add("active"):e.classList.remove("active")})),e.appendChild(i),e.appendChild(a),e.appendChild(s),this.composeParamField.appendChild(e)}for(let t in this.STRATEGIES){let e=document.createElement("div");if(e.id=`${t}-detail-field`,e.classList.add("detail-field"),0===this.STRATEGIES[t].otherDetails.length){let i=document.createElement("div");i.classList.add("parameter-row");let a=document.createElement("div");a.classList.add("parameter-label"),a.innerText=`${this.STRATEGIES[t].displayedName} is not needed to be configured.`,i.appendChild(a),e.appendChild(i)}else for(let i of this.STRATEGIES[t].otherDetails){let a=document.createElement("div");a.classList.add("parameter-row");let s=document.createElement("div");s.classList.add("parameter-label"),s.innerText=`${i}`;let n=document.createElement("input");n.classList.add("parameter-input"),n.classList.add("strategy-detail-input"),n.id=`${t}-${i}`,a.appendChild(s),a.appendChild(n),e.appendChild(a)}this.detailCntnr.appendChild(e)}}buildMyselfSettingView(){let t=document.createElement("div");t.classList.add("parameter-row");let e=document.createElement("div");e.classList.add("parameter-label"),e.innerText="Initial Total Cash";let i=document.createElement("input");i.classList.add("parameter-input"),i.type="number",i.id="my-init-total-cash",t.appendChild(e),t.appendChild(i),this.myselfParamField.appendChild(t),t=document.createElement("div"),t.classList.add("parameter-row"),e=document.createElement("div"),e.classList.add("parameter-label"),e.innerText="Initial Stock",i=document.createElement("input"),i.classList.add("parameter-input"),i.type="number",i.id="my-init-stock",t.appendChild(e),t.appendChild(i),this.myselfParamField.appendChild(t);for(let t in this.STRATEGIES){let e=document.createElement("div");if(e.id=`my-${t}-detail-field`,e.classList.add("detail-field"),0===this.STRATEGIES[t].otherDetails.length){let i=document.createElement("div");i.classList.add("parameter-row");let a=document.createElement("div");a.classList.add("parameter-label"),a.innerText=`${this.STRATEGIES[t].displayedName} is not needed to be configured.`,i.appendChild(a),e.appendChild(i)}else for(let i of this.STRATEGIES[t].otherDetails){let a=document.createElement("div");a.classList.add("parameter-row");let s=document.createElement("div");s.classList.add("parameter-label"),s.innerText=`${i}`;let n=document.createElement("input");n.classList.add("parameter-input"),n.classList.add("strategy-detail-input"),n.id=`my-${t}-${i}`,a.appendChild(s),a.appendChild(n),e.appendChild(a)}this.detailCntnr.appendChild(e)}t=document.createElement("div"),t.classList.add("parameter-row"),e=document.createElement("div"),e.classList.add("parameter-label"),e.innerText="Strategy";let a=document.createElement("select");a.classList.add("parameter-menu"),a.id="my-strategy-menu",a.addEventListener("click",(t=>{var e;this.detailCntnr.classList.add("active");for(let t of this.detailCntnr.children)t.classList.remove("active");t.currentTarget instanceof HTMLSelectElement&&(null===(e=document.getElementById(`my-${t.currentTarget.value}-detail-field`))||void 0===e||e.classList.add("active"));let i=document.getElementsByClassName("strategy-detail-btn");for(let e of i)e===t.currentTarget?e.classList.add("active"):e.classList.remove("active")}));for(let t in this.STRATEGIES){let e=document.createElement("option");e.value=t,e.innerText=this.STRATEGIES[t].displayedName,e.classList.add("parameter-menu-option"),a.options.add(e)}t.appendChild(e),t.appendChild(a),this.myselfParamField.appendChild(t)}enableChangeSetting(){this.settingBtn.disabled=!1,this.startBtn.disabled=!1}disableChangeSetting(){this.settingBtn.disabled=!0,this.startBtn.disabled=!0}initGeneralSetting(){this.initTotalCashInput.value="1000000",this.totalStockInput.value="1000000",this.initialEqInput.value="1",this.annualEconGrowthRateInput.value="0",this.dayToSimulateInput.value="250",this.pauseTimeInput.value="0"}readGeneralSetting(){this.initTotalCash=parseInt(this.initTotalCashInput.value),this.totalStock=parseInt(this.totalStockInput.value),this.initialEq=parseInt(this.initialEqInput.value),this.annualEconGrowthRate=parseFloat(this.annualEconGrowthRateInput.value),this.dayToSimulate=parseInt(this.dayToSimulateInput.value),this.pauseTime=parseInt(this.pauseTimeInput.value)}initCompositionSetting(){this.indiviComposition={"value-follower":{number:0,strategySetting:{name:"ValueFollower",params:{}}},"price-chaser":{number:199,strategySetting:{name:"PriceChaser",params:{}}},"bh-mix-grid":{number:0,strategySetting:{name:"BHmixGrid",params:{r:.1}}},"grid-const-ratio":{number:0,strategySetting:{name:"GridConstRatio",params:{sensitivity:.1,"stock-ratio":.5}}},chicken:{number:0,strategySetting:{name:"Chicken",params:{r:.2,"runaway-rate":.85}}}};for(let t in this.indiviComposition){document.getElementById(`${t}-number`).value=this.indiviComposition[t].number;for(let e in this.indiviComposition[t].strategySetting.params){document.getElementById(`${t}-${e}`).value=this.indiviComposition[t].strategySetting.params[e]}}}readCompositionSetting(){for(let t in this.indiviComposition){let e=document.getElementById(`${t}-number`);this.indiviComposition[t].number=parseInt(`${e.value}`);let i={};for(let e of this.STRATEGIES[t].otherDetails){let a=document.getElementById(`${t}-${e}`);i[e]=parseFloat(`${a.value}`)}this.indiviComposition[t].strategySetting.params=i}}initMyselfSetting(){this.myselfSetting={initialCash:1e3,initialStock:0,strategyLabel:"grid-const-ratio",strategySetting:{name:"GridConstRatio",params:{sensitivity:.05,"stock-ratio":.5}}},document.getElementById("my-init-total-cash").value=this.myselfSetting.initialCash,document.getElementById("my-init-stock").value=this.myselfSetting.initialStock;let t=document.getElementsByClassName("parameter-menu-option");for(let e of t)e.value===this.myselfSetting.strategyLabel?e.selected=!0:e.selected=!1;for(let t in this.myselfSetting.strategySetting.params){document.getElementById(`my-${this.myselfSetting.strategyLabel}-${t}`).value=this.myselfSetting.strategySetting.params[t]}}readMyselfSetting(){let t=document.getElementById("my-init-total-cash");this.myselfSetting.initialCash=parseInt(t.value);let e=document.getElementById("my-init-stock");this.myselfSetting.initialStock=parseInt(e.value);let i=document.getElementsByClassName("parameter-menu-option");for(let t of i)if(t.selected){this.myselfSetting.strategyLabel=t.value,this.myselfSetting.strategySetting.name=t.innerText;for(let e of this.STRATEGIES[t.value].otherDetails){let i=document.getElementById(`my-${t.value}-${e}`);this.myselfSetting.strategySetting.params[e]=i.value}}}refresh(){this.animationField.innerHTML="",void 0!==this.marketEqData&&void 0!==this.dealAmountData&&void 0!==this.myAssetData&&void 0!==this.individualList?(this.marketEqData.length=0,this.marketEqData.push(["Day","Given Price","Mkt. Eq."]),this.dealAmountData.length=0,this.dealAmountData.push(["Day","Deal Amount"]),this.myAssetData.length=0,this.myAssetData.push(["Day","Total Asset","Stock Mkt Val","Cash Holding"]),this.individualList.length=0):(this.marketEqData=[["Day","Given Price","Mkt. Eq."]],this.dealAmountData=[["Day","Deal Amount"]],this.myAssetData=[["Day","Total Asset","Stock Mkt Val","Cash Holding"]],this.individualList=[]),this.readGeneralSetting(),this.readCompositionSetting(),this.readMyselfSetting(),this.applyAllSetting()}start(){var e;let i=new o("pro",t.l);null===(e=document.getElementById("header"))||void 0===e||e.appendChild(i.button),this.buildCompositionSettingView(),this.buildMyselfSettingView(),this.initGeneralSetting(),this.initCompositionSetting(),this.initMyselfSetting(),this.refresh();for(let t of this.allSettingHeaderTabs)t.addEventListener("click",(t=>{var e;for(let t of this.allParamFields)t.classList.remove("active");t.currentTarget instanceof HTMLLabelElement&&(null===(e=document.getElementById(`${t.currentTarget.htmlFor}`))||void 0===e||e.classList.add("active"));for(let e of this.allSettingHeaderTabs)e===t.currentTarget?e.classList.add("active"):e.classList.remove("active");let i=document.getElementsByClassName("strategy-detail-btn");for(let t of i)t.classList.remove("active");this.detailCntnr.classList.remove("active")}));this.settingFooter.addEventListener("click",(()=>{this.refresh()})),this.startBtn.addEventListener("click",(()=>{this.refresh(),this.disableChangeSetting(),this.simulateOneDay()})),this.myAssetChartHeader.addEventListener("click",(()=>{this.myAssetChartCntnr.classList.remove("active")})),this.settingBtn.addEventListener("click",(()=>{this.settingBg.classList.add("active"),this.settingCntnr.classList.add("active"),this.detailCntnr.classList.add("is-setting")})),this.settingFooter.addEventListener("click",(()=>{this.settingBg.classList.remove("active"),this.settingCntnr.classList.remove("active"),this.detailCntnr.classList.remove("is-setting")})),this.resetBtn.addEventListener("click",(()=>{location.reload()})),this.myAssetChartDrawer=new S(this.myAssetChart),this.marketEqChartDrawer=new T(this.marketEqChart),this.dealAmountChartDrawer=new E(this.dealAmountChart),this.curveChartDrawer=new C(this.curveChart)}}).start()})()})();